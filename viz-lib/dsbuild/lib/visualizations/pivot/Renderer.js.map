{"version":3,"sources":["../../../src/visualizations/pivot/Renderer.tsx"],"names":["VALID_OPTIONS","formatRows","rows","columns","row","value","key","name","type","Renderer","data","options","onOptionsChange","config","setConfig","dataRows","onChange","updatedOptions","validOptions","hideControls","hideRowTotals","hideColumnTotals","propTypes","RendererPropTypes","defaultProps"],"mappings":";;;;;;;AAAA;;AACA;;AAEA;;AACA;;AACA;;AAEA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,IAAMA,aAAa,GAAG,CACpB,MADoB,EAEpB,MAFoB,EAGpB,MAHoB,EAIpB,gBAJoB,EAKpB,aALoB,EAMpB,SANoB,EAOpB,UAPoB,EAQpB,UARoB,EASpB,mBAToB,EAUpB,cAVoB,EAWpB,kBAXoB,EAYpB,uBAZoB,EAapB,oBAboB,EAcpB,WAdoB,EAepB,yBAfoB,EAgBpB,UAhBoB,EAiBpB,iBAjBoB,CAAtB;;AAoBA,SAASC,UAAT,OAA4C;AAAA,MAAtBC,IAAsB,QAAtBA,IAAsB;AAAA,MAAhBC,OAAgB,QAAhBA,OAAgB;AAC1C,SAAO,iBAAID,IAAJ,EAAUE,GAAG,IAAI,uBAAUA,GAAV,EAAe,CAACC,KAAD,EAAQC,GAAR,KAAgB,8BAAkBD,KAAlB,EAAyB,kBAAKF,OAAL,EAAc;AAAEI,IAAAA,IAAI,EAAED;AAAR,GAAd,EAA6BE,IAAtD,CAA/B,CAAjB,CAAP;AACD;;AAEc,SAASC,QAAT,QAA2D;AAAA,MAAvCC,IAAuC,SAAvCA,IAAuC;AAAA,MAAjCC,OAAiC,SAAjCA,OAAiC;AAAA,MAAxBC,eAAwB,SAAxBA,eAAwB;;AAAA,kBAC5C,uCAAcD,OAAd,EAD4C;AAAA;AAAA,MACjEE,MADiE;AAAA,MACzDC,SADyD;;AAExE,MAAMC,QAAQ,GAAG,oBAAQ,MAAMd,UAAU,CAACS,IAAD,CAAxB,EAAgC,CAACA,IAAD,CAAhC,CAAjB;AAEA,wBAAU,MAAM;AACdI,IAAAA,SAAS,mBAAMH,OAAN,EAAT;AACD,GAFD,EAEG,CAACA,OAAD,CAFH;;AAIA,MAAMK,QAAQ,GAAIC,cAAD,IAAyB;AACxC,QAAMC,YAAY,GAAG,kBAAKD,cAAL,EAAqBjB,aAArB,CAArB;AACAc,IAAAA,SAAS,mBAAMI,YAAN,EAAT;AACAN,IAAAA,eAAe,CAACM,YAAD,CAAf;AACD,GAJD,CARwE,CAcxE;;;AACA,MAAMC,YAAY,GAAG,iBAAIR,OAAJ,EAAa,kBAAb,CAArB;AACA,MAAMS,aAAa,GAAG,CAAC,iBAAIT,OAAJ,EAAa,iCAAb,CAAvB;AACA,MAAMU,gBAAgB,GAAG,CAAC,iBAAIV,OAAJ,EAAa,iCAAb,CAA1B;AACA,sBACE;AACE,IAAA,SAAS,EAAC,qCADZ;AAEE,0BAAoBQ,YAAY,IAAI,IAFtC;AAGE,4BAAsBC,aAAa,IAAI,IAHzC;AAIE,+BAAyBC,gBAAgB,IAAI,IAJ/C;AAKE,iBAAU;AALZ,kBAME,6BAAC,qBAAD,eAAkB,kBAAKR,MAAL,EAAab,aAAb,CAAlB;AAA+C,IAAA,IAAI,EAAEe,QAArD;AAA+D,IAAA,QAAQ,EAAEC;AAAzE,KANF,CADF;AAUD;;AAEDP,QAAQ,CAACa,SAAT,GAAqBC,4BAArB;AACAd,QAAQ,CAACe,YAAT,GAAwB;AAAEZ,EAAAA,eAAe,EAAE,MAAM,CAAE;AAA3B,CAAxB","sourcesContent":["import React, { useState, useEffect, useMemo } from \"react\";\nimport { get, find, pick, map, mapValues } from \"lodash\";\n// @ts-expect-error ts-migrate(7016) FIXME: Could not find a declaration file for module 'reac... Remove this comment to see the full error message\nimport PivotTableUI from \"react-pivottable/PivotTableUI\";\nimport { RendererPropTypes } from \"@/visualizations/prop-types\";\nimport { formatColumnValue } from \"@/lib/utils\";\n\nimport \"react-pivottable/pivottable.css\";\nimport \"./renderer.less\";\n\nconst VALID_OPTIONS = [\n  \"rows\",\n  \"cols\",\n  \"vals\",\n  \"aggregatorName\",\n  \"valueFilter\",\n  \"sorters\",\n  \"rowOrder\",\n  \"colOrder\",\n  \"derivedAttributes\",\n  \"rendererName\",\n  \"hiddenAttributes\",\n  \"hiddenFromAggregators\",\n  \"hiddenFromDragDrop\",\n  \"menuLimit\",\n  \"unusedOrientationCutoff\",\n  \"controls\",\n  \"rendererOptions\",\n];\n\nfunction formatRows({ rows, columns }: any) {\n  return map(rows, row => mapValues(row, (value, key) => formatColumnValue(value, find(columns, { name: key }).type)));\n}\n\nexport default function Renderer({ data, options, onOptionsChange }: any) {\n  const [config, setConfig] = useState({ ...options });\n  const dataRows = useMemo(() => formatRows(data), [data]);\n\n  useEffect(() => {\n    setConfig({ ...options });\n  }, [options]);\n\n  const onChange = (updatedOptions: any) => {\n    const validOptions = pick(updatedOptions, VALID_OPTIONS);\n    setConfig({ ...validOptions });\n    onOptionsChange(validOptions);\n  };\n\n  // Legacy behavior: hideControls when controls.enabled is true\n  const hideControls = get(options, \"controls.enabled\");\n  const hideRowTotals = !get(options, \"rendererOptions.table.rowTotals\");\n  const hideColumnTotals = !get(options, \"rendererOptions.table.colTotals\");\n  return (\n    <div\n      className=\"pivot-table-visualization-container\"\n      data-hide-controls={hideControls || null}\n      data-hide-row-totals={hideRowTotals || null}\n      data-hide-column-totals={hideColumnTotals || null}\n      data-test=\"PivotTableVisualization\">\n      <PivotTableUI {...pick(config, VALID_OPTIONS)} data={dataRows} onChange={onChange} />\n    </div>\n  );\n}\n\nRenderer.propTypes = RendererPropTypes;\nRenderer.defaultProps = { onOptionsChange: () => {} };\n"],"file":"Renderer.js"}