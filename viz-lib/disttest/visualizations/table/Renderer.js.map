{"version":3,"sources":["../../../src/visualizations/table/Renderer.tsx"],"names":["joinColumns","array","separator","result","item","index","push","getSearchColumns","columns","limit","Infinity","renderColumn","col","title","firstColumns","slice","restColumns","length","SearchInputInfoIcon","searchColumns","name","SearchInput","props","searchColumnsLimit","join","defaultProps","onChange","Renderer","options","data","searchTerm","setSearchTerm","orderBy","setOrderBy","tableColumns","searchInput","event","target","value","newOrderBy","document","getSelection","removeAllRanges","preparedRows","rows","size","position","pageSize","itemsPerPage","hideOnSinglePage","showSizeChanger","propTypes","RendererPropTypes"],"mappings":"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","sourcesContent":["import { filter, map, get, initial, last, reduce } from \"lodash\";\nimport React, { useMemo, useState, useEffect } from \"react\";\nimport Table from \"antd/lib/table\";\nimport Input from \"antd/lib/input\";\nimport InfoCircleFilledIcon from \"@ant-design/icons/InfoCircleFilled\";\nimport Popover from \"antd/lib/popover\";\nimport { RendererPropTypes } from \"@/visualizations/prop-types\";\n\nimport { prepareColumns, initRows, filterRows, sortRows } from \"./utils\";\n\nimport \"./renderer.less\";\n\nfunction joinColumns(array: any, separator = \", \") {\n  return reduce(\n    array,\n    (result, item, index) => {\n      // @ts-expect-error ts-migrate(2365) FIXME: Operator '>' cannot be applied to types 'string' a... Remove this comment to see the full error message\n      if (index > 0) {\n        // @ts-expect-error ts-migrate(2345) FIXME: Argument of type 'string' is not assignable to par... Remove this comment to see the full error message\n        result.push(separator);\n      }\n      // @ts-expect-error ts-migrate(2345) FIXME: Argument of type 'any' is not assignable to parame... Remove this comment to see the full error message\n      result.push(item);\n      return result;\n    },\n    []\n  );\n}\n\nfunction getSearchColumns(columns: any, { limit = Infinity, renderColumn = (col: any) => col.title } = {}) {\n  const firstColumns = map(columns.slice(0, limit), col => renderColumn(col));\n  const restColumns = map(columns.slice(limit), col => col.title);\n  if (restColumns.length > 0) {\n    return [...joinColumns(firstColumns), ` and ${restColumns.length} others`];\n  }\n  if (firstColumns.length > 1) {\n    return [...joinColumns(initial(firstColumns)), ` and `, last(firstColumns)];\n  }\n  return firstColumns;\n}\n\nfunction SearchInputInfoIcon({ searchColumns }: any) {\n  return (\n    <Popover\n      arrowPointAtCenter\n      placement=\"topRight\"\n      content={\n        <div className=\"table-visualization-search-info-content\">\n          Search {getSearchColumns(searchColumns, { renderColumn: col => <code key={col.name}>{col.title}</code> })}\n        </div>\n      }>\n      <InfoCircleFilledIcon className=\"table-visualization-search-info-icon\" />\n    </Popover>\n  );\n}\n\ntype OwnSearchInputProps = {\n  onChange?: (...args: any[]) => any;\n};\n\ntype SearchInputProps = OwnSearchInputProps & typeof SearchInput.defaultProps;\n\n// @ts-expect-error ts-migrate(2339) FIXME: Property 'searchColumns' does not exist on type 'S... Remove this comment to see the full error message\nfunction SearchInput({ searchColumns, ...props }: SearchInputProps) {\n  if (searchColumns.length <= 0) {\n    return null;\n  }\n\n  const searchColumnsLimit = 3;\n  return (\n    <Input.Search\n      {...props}\n      placeholder={`Search ${getSearchColumns(searchColumns, { limit: searchColumnsLimit }).join(\"\")}...`}\n      suffix={searchColumns.length > searchColumnsLimit ? <SearchInputInfoIcon searchColumns={searchColumns} /> : null}\n    />\n  );\n}\n\nSearchInput.defaultProps = {\n  onChange: () => {},\n};\n\nexport default function Renderer({ options, data }: any) {\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [orderBy, setOrderBy] = useState([]);\n\n  const searchColumns = useMemo(() => filter(options.columns, \"allowSearch\"), [options.columns]);\n\n  const tableColumns = useMemo(() => {\n    const searchInput =\n      searchColumns.length > 0 ? (\n        // @ts-expect-error ts-migrate(2322) FIXME: Type '(event: any) => void' is not assignable to t... Remove this comment to see the full error message\n        <SearchInput searchColumns={searchColumns} onChange={(event: any) => setSearchTerm(event.target.value)} />\n      ) : null;\n    return prepareColumns(options.columns, searchInput, orderBy, (newOrderBy: any) => {\n      setOrderBy(newOrderBy);\n      // Remove text selection - may occur accidentally\n      // @ts-expect-error ts-migrate(2531) FIXME: Object is possibly 'null'.\n      document.getSelection().removeAllRanges();\n    });\n  }, [options.columns, searchColumns, orderBy]);\n\n  const preparedRows = useMemo(() => sortRows(filterRows(initRows(data.rows), searchTerm, searchColumns), orderBy), [\n    data.rows,\n    searchTerm,\n    searchColumns,\n    orderBy,\n  ]);\n\n  // If data or config columns change - reset sorting\n  useEffect(() => {\n    setOrderBy([]);\n  }, [options.columns, data.columns]);\n\n  if (data.rows.length === 0) {\n    return null;\n  }\n\n  return (\n    <div className=\"table-visualization-container\">\n      <Table\n        className=\"table-fixed-header\"\n        data-percy=\"show-scrollbars\"\n        data-test=\"TableVisualization\"\n        // @ts-expect-error ts-migrate(2322) FIXME: Type '{ key: any; dataIndex: string; align: any; s... Remove this comment to see the full error message\n        columns={tableColumns}\n        dataSource={preparedRows}\n        pagination={{\n          size: get(options, \"paginationSize\", \"\"),\n          // @ts-expect-error ts-migrate(2322) FIXME: Type 'string' is not assignable to type 'TablePagi... Remove this comment to see the full error message\n          position: \"bottom\",\n          pageSize: options.itemsPerPage,\n          hideOnSinglePage: true,\n          showSizeChanger: false,\n        }}\n        showSorterTooltip={false}\n      />\n    </div>\n  );\n}\n\nRenderer.propTypes = RendererPropTypes;\n"],"file":"Renderer.js"}