{"version":3,"sources":["../../src/visualizations/Renderer.tsx"],"names":["Renderer","type","data","optionsProp","options","visualizationName","addonBefore","addonAfter","otherProps","lastOptions","errorHandlerRef","registeredVisualizations","getOptions","current","reset"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AAEA;;;;;;;;;;;;;;AAYe,SAASA,QAAT,OAQL;AAAA,MAPRC,IAOQ,QAPRA,IAOQ;AAAA,MANRC,IAMQ,QANRA,IAMQ;AAAA,MALCC,WAKD,QALRC,OAKQ;AAAA,MAJRC,iBAIQ,QAJRA,iBAIQ;AAAA,MAHRC,WAGQ,QAHRA,WAGQ;AAAA,MAFRC,UAEQ,QAFRA,UAEQ;AAAA,MADLC,UACK;;AACR,MAAMC,WAAW,GAAG,oBAApB;AACA,MAAMC,eAAe,GAAG,oBAAxB,CAFQ,CAIR;;AAJQ,8BAKyBC,kCAAyBV,IAAzB,CALzB;AAAA,MAKAD,QALA,yBAKAA,QALA;AAAA,MAKUY,UALV,yBAKUA,UALV,EAOR;AACA;AACA;AACA;;AACA,MAAIR,OAAO,GAAGQ,UAAU,CAACT,WAAD,EAAcD,IAAd,CAAxB;;AACA,MAAI,qBAAQO,WAAW,CAACI,OAApB,EAA6BT,OAA7B,CAAJ,EAA2C;AACzCA,IAAAA,OAAO,GAAGK,WAAW,CAACI,OAAtB;AACD;;AACDJ,EAAAA,WAAW,CAACI,OAAZ,GAAsBT,OAAtB;AAEA,wBAAU,MAAM;AACd,QAAIM,eAAe,CAACG,OAApB,EAA6B;AAC3B;AACAH,MAAAA,eAAe,CAACG,OAAhB,CAAwBC,KAAxB;AACD;AACF,GALD,EAKG,CAACX,WAAD,EAAcD,IAAd,CALH;AAOA,sBACE;AAAK,IAAA,SAAS,EAAC;AAAf,KACGI,WADH,eAGE,6BAAC,sBAAD;AACE,IAAA,GAAG,EAAEI,eADP;AAEE,IAAA,WAAW,EAAE,mBAAM,6BAAC,2BAAD;AAFrB,kBAGE;AAAK,IAAA,SAAS,EAAC;AAAf,kBACE,6BAAC,QAAD;AAAU,IAAA,OAAO,EAAEN,OAAnB;AAA4B,IAAA,IAAI,EAAEF,IAAlC;AAAwC,IAAA,iBAAiB,EAAEG;AAA3D,KAAkFG,UAAlF,EADF,CAHF,CAHF,EAUGD,UAVH,CADF;AAcD","sourcesContent":["import { isEqual } from \"lodash\";\nimport React, { useEffect, useRef } from \"react\";\nimport ErrorBoundary, { ErrorMessage } from \"@/components/ErrorBoundary\";\nimport { RendererPropTypes } from \"@/visualizations/prop-types\";\nimport registeredVisualizations from \"@/visualizations/registeredVisualizations\";\n\n/*\n(ts-migrate) TODO: Migrate the remaining prop types\n...RendererPropTypes\n*/\ntype Props = {\n  type: string;\n  addonBefore?: React.ReactNode;\n  addonAfter?: React.ReactNode;\n} & typeof RendererPropTypes;\n\nexport default function Renderer({\n  type,\n  data,\n  options: optionsProp,\n  visualizationName,\n  addonBefore,\n  addonAfter,\n  ...otherProps\n}: Props) {\n  const lastOptions = useRef();\n  const errorHandlerRef = useRef();\n\n  // @ts-expect-error ts-migrate(7053) FIXME: Element implicitly has an 'any' type because expre... Remove this comment to see the full error message\n  const { Renderer, getOptions } = registeredVisualizations[type];\n\n  // Avoid unnecessary updates (which may be expensive or cause issues with\n  // internal state of some visualizations like Table) - compare options deeply\n  // and use saved reference if nothing changed\n  // More details: https://github.com/getredash/redash/pull/3963#discussion_r306935810\n  let options = getOptions(optionsProp, data);\n  if (isEqual(lastOptions.current, options)) {\n    options = lastOptions.current;\n  }\n  lastOptions.current = options;\n\n  useEffect(() => {\n    if (errorHandlerRef.current) {\n      // @ts-expect-error ts-migrate(2532) FIXME: Object is possibly 'undefined'.\n      errorHandlerRef.current.reset();\n    }\n  }, [optionsProp, data]);\n\n  return (\n    <div className=\"visualization-renderer\">\n      {addonBefore}\n      {/* @ts-expect-error ts-migrate(2769) FIXME: No overload matches this call. */}\n      <ErrorBoundary\n        ref={errorHandlerRef}\n        renderError={() => <ErrorMessage>Error while rendering visualization.</ErrorMessage>}>\n        <div className=\"visualization-renderer-wrapper\">\n          <Renderer options={options} data={data} visualizationName={visualizationName} {...otherProps} />\n        </div>\n      </ErrorBoundary>\n      {addonAfter}\n    </div>\n  );\n}\n"],"file":"Renderer.js"}