{"version":3,"sources":["../../../src/visualizations/cohort/Cornelius.tsx"],"names":["momentInterval","daily","weekly","monthly","yearly","timeLabelFormats","defaultOptions","initialDate","timeInterval","noValuePlaceholder","rawNumberOnHover","displayAbsoluteValues","initialIntervalNumber","maxColumns","Infinity","title","timeColumnTitle","peopleColumnTitle","stageColumnTitle","numberFormat","percentFormat","timeLabelFormat","colors","min","max","steps","prepareOptions","options","formatNumber","formatPercent","getColorForValue","chroma","scale","mode","domain","classes","isLightColor","backgroundColor","white","black","contrast","formatStageTitle","index","formatTimeLabel","offset","interval","clone","add","format","CorneliusHeader","maxRowLength","cells","i","push","CorneliusRow","data","baseValue","value","percentageValue","cellProps","key","className","children","style","color","Cornelius","d","length","row","defaultProps"],"mappings":"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","sourcesContent":["/*!\n * React port of Cornelius library (based on v0.1 released under the MIT license)\n * Original library: http://restorando.github.io/cornelius\n */\n\nimport { isNil, isFinite, map, extend, min, max } from \"lodash\";\nimport moment from \"moment\";\nimport chroma from \"chroma-js\";\nimport React, { useMemo } from \"react\";\nimport Tooltip from \"antd/lib/tooltip\";\nimport { createNumberFormatter, formatSimpleTemplate } from \"@/lib/value-format\";\nimport chooseTextColorForBackground from \"@/lib/chooseTextColorForBackground\";\n\nimport \"./cornelius.less\";\n\nconst momentInterval = {\n  daily: \"days\",\n  weekly: \"weeks\",\n  monthly: \"months\",\n  yearly: \"years\",\n};\n\nconst timeLabelFormats = {\n  daily: \"MMMM D, YYYY\",\n  weekly: \"[Week of] MMM D, YYYY\",\n  monthly: \"MMMM YYYY\",\n  yearly: \"YYYY\",\n};\n\nconst defaultOptions = {\n  initialDate: null,\n  timeInterval: \"monthly\",\n  noValuePlaceholder: \"-\",\n  rawNumberOnHover: true,\n  displayAbsoluteValues: false,\n  initialIntervalNumber: 1,\n  maxColumns: Infinity,\n\n  title: null,\n  timeColumnTitle: \"Time\",\n  peopleColumnTitle: \"People\",\n  stageColumnTitle: \"{{ @ }}\",\n  numberFormat: \"0,0[.]00\",\n  percentFormat: \"0.00%\",\n  timeLabelFormat: timeLabelFormats.monthly,\n\n  colors: {\n    min: \"#ffffff\",\n    max: \"#041d66\",\n    steps: 7,\n  },\n};\n\nfunction prepareOptions(options: any) {\n  options = extend({}, defaultOptions, options, {\n    initialDate: moment(options.initialDate),\n    colors: extend({}, defaultOptions.colors, options.colors),\n  });\n\n  return extend(options, {\n    // @ts-expect-error ts-migrate(7053) FIXME: Element implicitly has an 'any' type because expre... Remove this comment to see the full error message\n    timeLabelFormat: timeLabelFormats[options.timeInterval],\n    formatNumber: createNumberFormatter(options.numberFormat),\n    formatPercent: createNumberFormatter(options.percentFormat),\n    getColorForValue: chroma\n      .scale([options.colors.min, options.colors.max])\n      .mode(\"hsl\")\n      .domain([0, 100])\n      .classes(options.colors.steps),\n  });\n}\n\nfunction isLightColor(backgroundColor: any) {\n  backgroundColor = chroma(backgroundColor);\n  const white = \"#ffffff\";\n  const black = \"#000000\";\n  return chroma.contrast(backgroundColor, white) < chroma.contrast(backgroundColor, black);\n}\n\nfunction formatStageTitle(options: any, index: any) {\n  return formatSimpleTemplate(options.stageColumnTitle, { \"@\": options.initialIntervalNumber - 1 + index });\n}\n\nfunction formatTimeLabel(options: any, offset: any) {\n  // @ts-expect-error ts-migrate(7053) FIXME: Element implicitly has an 'any' type because expre... Remove this comment to see the full error message\n  const interval = momentInterval[options.timeInterval];\n  return options.initialDate\n    .clone()\n    .add(offset, interval)\n    .format(options.timeLabelFormat);\n}\n\nfunction CorneliusHeader({ options, maxRowLength }: any) {\n  // eslint-disable-line react/prop-types\n  const cells = [];\n  for (let i = 1; i < maxRowLength; i += 1) {\n    cells.push(\n      <th key={`col${i}`} className=\"cornelius-stage\">\n        {formatStageTitle(options, i)}\n      </th>\n    );\n  }\n\n  return (\n    <tr>\n      <th className=\"cornelius-time\">{options.timeColumnTitle}</th>\n      <th className=\"cornelius-people\">{options.peopleColumnTitle}</th>\n      {cells}\n    </tr>\n  );\n}\n\nfunction CorneliusRow({ options, data, index, maxRowLength }: any) {\n  // eslint-disable-line react/prop-types\n  const baseValue = data[0] || 0;\n\n  const cells = [];\n  for (let i = 1; i < maxRowLength; i += 1) {\n    const value = data[i];\n    const percentageValue = isFinite(value / baseValue) ? (value / baseValue) * 100 : null;\n    const cellProps = { key: `col${i}` };\n\n    if (isNil(percentageValue)) {\n      // @ts-expect-error ts-migrate(2339) FIXME: Property 'className' does not exist on type '{ key... Remove this comment to see the full error message\n      cellProps.className = \"cornelius-empty\";\n      // @ts-expect-error ts-migrate(2339) FIXME: Property 'children' does not exist on type '{ key:... Remove this comment to see the full error message\n      cellProps.children = options.noValuePlaceholder;\n    } else {\n      // @ts-expect-error ts-migrate(2339) FIXME: Property 'className' does not exist on type '{ key... Remove this comment to see the full error message\n      cellProps.className = options.displayAbsoluteValues ? \"cornelius-absolute\" : \"cornelius-percentage\";\n      // @ts-expect-error ts-migrate(2339) FIXME: Property 'children' does not exist on type '{ key:... Remove this comment to see the full error message\n      cellProps.children = options.displayAbsoluteValues\n        ? options.formatNumber(value)\n        : options.formatPercent(percentageValue);\n\n      const backgroundColor = options.getColorForValue(percentageValue);\n      // @ts-expect-error ts-migrate(2339) FIXME: Property 'style' does not exist on type '{ key: st... Remove this comment to see the full error message\n      cellProps.style = {\n        backgroundColor,\n        color: chooseTextColorForBackground(backgroundColor),\n      };\n      // @ts-expect-error ts-migrate(2339) FIXME: Property 'style' does not exist on type '{ key: st... Remove this comment to see the full error message\n      if (isLightColor(cellProps.style.color)) {\n        // @ts-expect-error ts-migrate(2339) FIXME: Property 'className' does not exist on type '{ key... Remove this comment to see the full error message\n        cellProps.className += \" cornelius-white-text\";\n      }\n\n      if (options.rawNumberOnHover && !options.displayAbsoluteValues) {\n        // @ts-expect-error ts-migrate(2339) FIXME: Property 'children' does not exist on type '{ key:... Remove this comment to see the full error message\n        cellProps.children = (\n          <Tooltip title={options.formatNumber(value)} mouseEnterDelay={0} mouseLeaveDelay={0}>\n            {/* @ts-expect-error ts-migrate(2339) FIXME: Property 'children' does not exist on type '{ key:... Remove this comment to see the full error message */}\n            <div>{cellProps.children}</div>\n          </Tooltip>\n        );\n      }\n    }\n\n    cells.push(<td {...cellProps} />);\n  }\n\n  return (\n    <tr>\n      <td className=\"cornelius-label\">{formatTimeLabel(options, index)}</td>\n      <td className=\"cornelius-people\">{options.formatNumber(baseValue)}</td>\n      {cells}\n    </tr>\n  );\n}\n\ntype OwnCorneliusProps = {\n  data?: number[][];\n  options?: {\n    initialDate: any; // TODO: PropTypes.instanceOf(Date)\n    timeInterval?: \"daily\" | \"weekly\" | \"monthly\" | \"yearly\";\n    noValuePlaceholder?: string;\n    rawNumberOnHover?: boolean;\n    displayAbsoluteValues?: boolean;\n    initialIntervalNumber?: number;\n    maxColumns?: number;\n    title?: string;\n    timeColumnTitle?: string;\n    peopleColumnTitle?: string;\n    stageColumnTitle?: string;\n    numberFormat?: string;\n    percentFormat?: string;\n    timeLabelFormat?: string;\n    colors?: {\n      min?: string;\n      max?: string;\n      steps?: number;\n    };\n  };\n};\n\ntype CorneliusProps = OwnCorneliusProps & typeof Cornelius.defaultProps;\n\nexport default function Cornelius({ data, options }: CorneliusProps) {\n  options = useMemo(() => prepareOptions(options), [options]);\n\n  const maxRowLength = useMemo(\n    () =>\n      min([\n        // @ts-expect-error ts-migrate(2339) FIXME: Property 'length' does not exist on type 'number'.\n        max(map(data, d => d.length)) || 0,\n        // @ts-expect-error ts-migrate(2532) FIXME: Object is possibly 'undefined'.\n        options.maxColumns + 1, // each row includes totals, but `maxColumns` is only for stage columns\n      ]),\n    [data, options.maxColumns]\n  );\n\n  if (data.length === 0) {\n    return null;\n  }\n\n  return (\n    <div className=\"cornelius-container\">\n      {options.title && <div className=\"cornelius-title\">{options.title}</div>}\n\n      <table className=\"cornelius-table\">\n        <thead>\n          <CorneliusHeader options={options} maxRowLength={maxRowLength} />\n        </thead>\n        <tbody>\n          {map(data, (row, index) => (\n            <CorneliusRow key={`row${index}`} options={options} data={row} index={index} maxRowLength={maxRowLength} />\n          ))}\n        </tbody>\n      </table>\n    </div>\n  );\n}\n\nCornelius.defaultProps = {\n  data: [],\n  options: {},\n};\n"],"file":"Cornelius.js"}