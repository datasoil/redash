{"version":3,"sources":["../../src/lib/value-format.tsx"],"names":["numeral","options","scalePercentBy100","urlPattern","hasOwnProperty","Object","prototype","createTextFormatter","highlightLinks","value","Link","visualizationsSettings","LinkComponent","replace","unused","prefix","href","link","ReactDOMServer","renderToStaticMarkup","toMoment","moment","isMoment","ISO_8601","RFC_2822","createDateTimeFormatter","format","wrapped","isValid","createBooleanFormatter","values","length","createNumberFormatter","n","set","formatSimpleTemplate","str","data","match","prop","call"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport ReactDOMServer from \"react-dom/server\";\nimport moment from \"moment/moment\";\nimport numeral from \"numeral\";\nimport { isString, isArray, isUndefined, isFinite, isNil, toString } from \"lodash\";\nimport { visualizationsSettings } from \"@/visualizations/visualizationsSettings\";\n\nnumeral.options.scalePercentBy100 = false;\n\n// eslint-disable-next-line\nconst urlPattern = /(^|[\\s\\n]|<br\\/?>)((?:https?|ftp):\\/\\/[\\-A-Z0-9+\\u0026\\u2019@#\\/%?=()~_|!:,.;]*[\\-A-Z0-9+\\u0026@#\\/%=~()_|])/gi;\n\nconst hasOwnProperty = Object.prototype.hasOwnProperty;\n\nexport function createTextFormatter(highlightLinks: any) {\n  if (highlightLinks) {\n    return (value: any) => {\n      if (isString(value)) {\n        const Link = visualizationsSettings.LinkComponent;\n        value = value.replace(urlPattern, (unused, prefix, href) => {\n          const link = ReactDOMServer.renderToStaticMarkup(\n            <Link href={href} target=\"_blank\" rel=\"noopener noreferrer\">\n              {href}\n            </Link>\n          );\n          return prefix + link;\n        });\n      }\n      return toString(value);\n    };\n  }\n  return (value: any) => toString(value);\n}\n\nfunction toMoment(value: any) {\n  if (moment.isMoment(value)) {\n    return value;\n  }\n  if (isFinite(value)) {\n    return moment(value);\n  }\n  // same as default `moment(value)`, but avoid fallback to `new Date()`\n  return moment(toString(value), [moment.ISO_8601, moment.RFC_2822]);\n}\n\nexport function createDateTimeFormatter(format: any) {\n  if (isString(format) && format !== \"\") {\n    return (value: any) => {\n      const wrapped = toMoment(value);\n      return wrapped.isValid() ? wrapped.format(format) : toString(value);\n    };\n  }\n  return (value: any) => toString(value);\n}\n\nexport function createBooleanFormatter(values: any) {\n  if (isArray(values)) {\n    if (values.length >= 2) {\n      // Both `true` and `false` specified\n      return (value: any) => {\n        if (isNil(value)) {\n          return \"\";\n        }\n        return \"\" + values[value ? 1 : 0];\n      };\n    } else if (values.length === 1) {\n      // Only `true`\n      return (value: any) => (value ? values[0] : \"\");\n    }\n  }\n  return (value: any) => {\n    if (isNil(value)) {\n      return \"\";\n    }\n    return value ? \"true\" : \"false\";\n  };\n}\n\nexport function createNumberFormatter(format: any) {\n  if (isString(format) && format !== \"\") {\n    const n = numeral(0); // cache `numeral` instance\n    return (value: any) => (value === null || value === \"\" ? \"\" : n.set(value).format(format));\n  }\n  return (value: any) => toString(value);\n}\n\nexport function formatSimpleTemplate(str: any, data: any) {\n  if (!isString(str)) {\n    return \"\";\n  }\n  return str.replace(/{{\\s*([^\\s]+?)\\s*}}/g, (match, prop) => {\n    if (hasOwnProperty.call(data, prop) && !isUndefined(data[prop])) {\n      return data[prop];\n    }\n    return match;\n  });\n}\n"],"file":"value-format.js"}